!function(e,t){"object"==typeof exports&&"object"==typeof module?module.exports=t():"function"==typeof define&&define.amd?define([],t):"object"==typeof exports?exports.CompressImg=t():e.CompressImg=t()}(window,(function(){return(i={},e.m=t=[function(e,t,i){"use strict";function n(e,t){for(var i=0;i<t.length;i++){var n=t[i];n.enumerable=n.enumerable||!1,n.configurable=!0,"value"in n&&(n.writable=!0),Object.defineProperty(e,n.key,n)}}Object.defineProperty(t,"__esModule",{value:!0}),t.default=void 0;var o=function(){function e(){!function(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}(this,e),console.log(this)}var t,i;return t=e,(i=[{key:"createCanvas",value:function(){this.canvas=document.createElement("canvas"),this.context=this.canvas.getContext("2d"),this.context.fillStyle="#fff"}},{key:"createImg",value:function(){this.img=new Image,this.img.crossOrigin="anonymous"}},{key:"createUrl",value:function(e){var t;return null!=window.createObjectURL?t=window.createObjectURL(e):null!=window.URL?t=window.URL.createObjectURL(e):null!=window.webkitURL&&(t=window.webkitURL.createObjectURL(e)),t}},{key:"drawImg",value:function(e){var t=this.img,i=t.width,n=t.height;if(n<i?2e3<i&&(e=+(2e3/i).toFixed(1)+Number(e),this.img.width=2e3,this.img.height=n*(2e3/i)):2e3<n&&(e=+(2e3/n).toFixed(1)+Number(e),this.img.height=2e3,this.img.width=i*(2e3/n)),this.canvas.width=this.img.width,this.canvas.height=this.img.height,this.context.fillRect(0,0,this.canvas.width,this.canvas.height),1e6<this.img.width*this.img.height)for(var o=Math.floor(this.canvas.width/4),r=Math.floor(i/4),a=0;a<4;a++)this.context.drawImage(this.img,r*a,0,r,n,o*a,0,o,this.canvas.height);else this.context.drawImage(this.img,0,0,this.img.width,this.img.height);return e}},{key:"toTempImg",value:function(e){var t=this;return new Promise((function(i,n){t.canvas.toBlob((function(e){e||n("导出失败"),i(new File([e],e.name))}),"image/jpeg",e)}))}},{key:"compress",value:function(e){var t=this,i=0<arguments.length&&void 0!==e?e:{};console.log(i);var n=i.src,o=i.file,r=i.ratio,a=void 0===r?.99:r;if(!o&&!n)throw"未传入图片";return this.createCanvas(),this.createImg(),n?this.img.src=n:o&&(this.img.src=this.createUrl(o)),new Promise((function(e,i){t.img.onload=function(){t.toTempImg(t.drawImg(a)).then((function(i){console.log(i),e({url:t.createUrl(i),file:i})})).catch((function(e){i("导出失败")}))}}))}}])&&n(t.prototype,i),e}();t.default=o}],e.c=i,e.d=function(t,i,n){e.o(t,i)||Object.defineProperty(t,i,{enumerable:!0,get:n})},e.r=function(e){"undefined"!=typeof Symbol&&Symbol.toStringTag&&Object.defineProperty(e,Symbol.toStringTag,{value:"Module"}),Object.defineProperty(e,"__esModule",{value:!0})},e.t=function(t,i){if(1&i&&(t=e(t)),8&i)return t;if(4&i&&"object"==typeof t&&t&&t.__esModule)return t;var n=Object.create(null);if(e.r(n),Object.defineProperty(n,"default",{enumerable:!0,value:t}),2&i&&"string"!=typeof t)for(var o in t)e.d(n,o,function(e){return t[e]}.bind(null,o));return n},e.n=function(t){var i=t&&t.__esModule?function(){return t.default}:function(){return t};return e.d(i,"a",i),i},e.o=function(e,t){return Object.prototype.hasOwnProperty.call(e,t)},e.p="",e(e.s=0)).default;function e(n){if(i[n])return i[n].exports;var o=i[n]={i:n,l:!1,exports:{}};return t[n].call(o.exports,o,o.exports,e),o.l=!0,o.exports}var t,i}));